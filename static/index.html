<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>My super Twitter Clone</title>
    <link rel="stylesheet" href="/static/styles.css" />
  </head>
  <body>
    <div class="wrapper">
   <h1>My <strong>Super</strong> Twitter Clone</h1>
    <textarea placeholder="Tweet something" rows="10" name="textareaTweet" id="textareaTweet" class="textareaTweet"></textarea>
    <button id="buttonTweet">Tweet that !</button>
    <div id="tweetList"></div>
    </div>
    <script>
      document.getElementById("buttonTweet").addEventListener("click", postTweet);

      async function postTweet() {
        // reset animation
        var postTweetDiv = document.getElementById('tweetList');
        postTweetDiv.innerHTML = "";
        postTweetDiv.style.animation = 'none';
        postTweetDiv.offsetHeight;
        postTweetDiv.style.animation = null; 
        fetchTweets();
      }

      async function fetchTweets() {
        try {
          const response = await fetch('http://127.0.0.1:8888/tweets')
      
          if (!response.ok) {
            throw new Error('Network response was not ok.')
          }

          const data = await response.json();
      
          const tweetList = document.getElementById('tweetList')
          data.results.forEach((tweet) => {
            const date = new Date(tweet.date)
            const formattedDate = date.toUTCString();
            const tweetItem = document.createElement('div');
            tweetItem.id = 'id-' + tweet.id;
            tweetItem.classList.add('tweet');

            const tweetMessage = document.createElement('div');
            tweetMessage.classList.add('tweetMessage');
            tweetMessage.textContent = tweet.message;
            tweetItem.appendChild(tweetMessage);

            const tweetDate = document.createElement('div');
            tweetDate.classList.add('tweetDate');
            tweetDate.textContent = formattedDate;
            tweetItem.appendChild(tweetDate);
            
            const button = document.createElement('button');
            button.textContent = 'delete';
            button.classList.add('buttonDelete');
            tweetItem.appendChild(button);
            
            tweetList.appendChild(tweetItem);
      
            button.addEventListener('click', function () {
              alert('Delete :' + tweet.id)
            })
          })
        } catch (error) {
          console.error('There was a problem fetching the data:', error)
        }
      }
      
      window.onload = fetchTweets;
    </script>
  </body>
</html>
